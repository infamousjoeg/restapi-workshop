<!-- DO NOT MODIFY BELOW -->
import { Notes, Head, Appear } from "mdx-deck";
import { CodeSurfer, CodeSurferColumns, Step } from "code-surfer";
import {
  nightOwl as secondary,
  vsDark as primary
} from "@code-surfer/themes";

import "prismjs/components/prism-powershell";

<!-- Default theme -->
export const theme = primary;

<!-- DO NOT MODIFY ABOVE -->

<!-- CONFIG VARIABLES -->
export const city = "World Wide Web";
export const presenter = "Joe Garcia";
export const title = "DevOps Security Engineer";

<Head>
  <title>CyberArk REST API Workshop - {city}</title>
  <link rel="shortcut icon" href="./src/icons/favicon.ico" type="image/ico" />
</Head>

# REST API Workshop

<h2>{city}</h2>

Presented by [CyberArk](https://cyberark.com)

---

# Hello üëãüèª

<h2>I am {presenter}</h2>

<h3>{title} for <a href="https://cyberark.com">CyberArk</a></h3>

---

# Agenda üïô

## Hour 1Ô∏è‚É£

<ul>
  <Appear>
    <li>You know everything up until now</li>
    <li>Go over agenda - which is happening now</li>
    <li>v9 to v10 API changes</li>
    <li>Explore available support tools</li>
    <li>Both CyberArk & community</li>
  </Appear>
</ul>

---

# Agenda üïô

## Hour 2Ô∏è‚É£

<ul>
  <Appear>
    <li>Postman Deep Dive</li>
    <li>psPAS Deep Dive</li>
  </Appear>
</ul>

---

# Agenda üïô

## LUNCH! (30 minutes)

# üçî

---

# Agenda üïô

## Hour 3Ô∏è‚É£

<ul>
  <Appear>
    <li>SkyTap Environment Overview</li>
    <li>Create Function for Role-Based Security Groups</li>
  </Appear>
</ul>

---

# Agenda üïô

## Hour 4Ô∏è‚É£

<ul>
  <Appear>
    <li>Create Safe & Safe Members Script <i>(CyberArk Safe Factory)</i></li>
    <li>Q&A Session</li>
  </Appear>
</ul>

---

# v9 -> v10 API Changes

<ul>
  <Appear>
    <li>Change from <b>/WebServices/</b> to <b>/api/</b> URI</li>
    <li>PVWA UI in v10 <i>uses</i> the same REST API exposed to customers</li>
    <li>As new features appear in PVWA, they will be available in our REST API</li>
    <li>No... I don't know when we can Move Accounts via REST API üôÅ</li>
    <li>I also don't know when we'll be able to automate linked accounts like Logon & Reconcile üò´</li>
  </Appear>
</ul>

---

# Exploring Support Tools üõ†

## CyberArk Supported Tools

---

# epv-api-scripts

<ul>
  <Appear>
    <li><h2>Contains CyberArk Supported Examples</h2></li>
    <li><h2>Account Onboarding Utility</h2></li>
    <li><h2>Automatic Onboarding Rules</h2></li>
    <li><h2>PSM, Platforms, Security Events, and more!</h2></li>
  </Appear>
</ul>

---

# epv-api-scripts

[Go to https://github.com/cyberark/epv-api-scripts](https://github.com/cyberark/epv-api-scripts)

---

# Account Onboarding Utility

<ul>
  <Appear>
    <li>Supported by CyberArk R&D</li>
    <li>Supports v9.8 and above of PVWA</li>
    <li>Supports basic account and safe creation, much like PUU</li>
  </Appear>
</ul>

---

<CodeSurfer>

```powershell title="Create Command" subtitle="Creates safes and accounts"
Accounts_Onboard_Utility.ps1 `
  # PVWA Base URL
  -PVWAURL https://components.cyberarkdemo.com `
  # Method
  -Create `
  # Authentication Type: cyberark, ldap, windows, saml, radius (all methods)
  -AuthType ldap `
  # Safe name to copy permissions from when creating a new safe (optional)
  -TemplateSafe WinLocalTemplate `
  # Path to the CSV containing account metadata
  -CsvPath "${env:userprofile}\Documents\cyberark-import.csv"
```

```powershell title="Update Command" subtitle="Updates accounts or creates safes and accounts"
Accounts_Onboard_Utility.ps1 `
  # PVWA Base URL
  -PVWAURL https://components.cyberarkdemo.com `
  # Change the method to Update and everything can stay the same
  -Update `
  # Authentication Type: cyberark, ldap, windows, saml, radius (all methods)
  -AuthType ldap `
  # Safe name to copy permissions from when creating a new safe (optional)
  -TemplateSafe WinLocalTemplate `
  # Path to the CSV containing account metadata
  -CsvPath "${env:userprofile}\Documents\cyberark-import.csv"
```

</CodeSurfer>

---

# CyberArk Online Documentation

[https://docs.cyberark.com](https://docs.cyberark.com)

---

# Swagger UI

<ul>
  <Appear>
    <li>Accessed at <u>https://pvwa.yourdomain.com/PasswordVault/swagger</u></li>
    <li>Similar to Postman Documentation & Collection</li>
    <li>Built into Password Vault Web Access (PVWA)</li>
    <li>Only shows relevant API endpoints for the PVWA version</li>
  </Appear>
</ul>

---

# Exploring Support Tools üõ†

## Community Contributed Tools

---

# CyberArk Automation Greatest Hits

[https://cybr.rocks/greatesthits](https://cybr.rocks/greatesthits)

---

# Postman Documentation & Collection

## Documentation available publicly

[https://cybr.rocks/RESTAPI](https://cybr.rocks/RESTAPI)

## Available within Postman App as Collection

_Shown via Live Demo_

---

# psPAS

<ul>
  <Appear>
    <li><h2>What is it?</h2></li>
      <ul>
        <li>PowerShell Module</li>
        <li>Maintained by psPete</li>
        <li>Creates easy cmdlets to deal with CyberArk's API</li>
      </ul>
  </Appear>
</ul>

---

<CodeSurfer>

```powershell title="How to install psPAS" subtitle="psPAS is available on the PowerShell Gallery"
Install-Module psPAS
```

```powershell title="How to update psPAS"
Update-Module psPAS
```

</CodeSurfer>

---

# psPAS

## Features

<ul>
  <Appear>
    <li>Token-less session authorization</li>
    <li>Supports push, append & challenge/response MFA</li>
    <li>Supports piping to simplify commands</li>
  </Appear>
</ul>

---

<CodeSurfer>

```powershell title="Token-less Session Authorization" subtitle="After successful authentication, token is held in session"
# Since token is stored in the session, no need to save
# the response in a variable for reference later.
New-PASSession -BaseURI https://components.cyberarkdemo.com -Type ldap -Credentials $(Get-Credentials)
```

```diff 3 title="Parameters" subtitle="BaseURI, Type, and Credentials are required"

```

```diff 3[72:103] title="PSCredential Object" subtitle="psPAS requires a PSCredential Object for security"

```

```diff 3[85:103] title="PSCredential Object" subtitle="This will prompt the user for their username & password"

```

</CodeSurfer>

---

<CodeSurfer>

```powershell title="MFA Support" subtitle="Push Mode"
New-PASSession -BaseURI https://components.cyberarkdemo.com -Type radius -Credentials $(Get-Credentials)
```

```powershell 1[74:101] title="MFA Support" subtitle="Append Mode"
New-PASSession -BaseURI https://components.cyberarkdemo.com -Type radius -OTPMode Append -OTP 123456 -Credentials $(Get-Credentials)
```

```powershell 1[74:104] title="MFA Support" subtitle="Challenge/Response Mode"
New-PASSession -BaseURI https://components.cyberarkdemo.com -Type radius -OTPMode Challenge -OTP 123456 -Credentials $(Get-Credentials)
```

</CodeSurfer>

---

<CodeSurfer>

```powershell title="Piping Support for Advanced Users" subtitle="List Safe Members by Specific Permission"
Get-PASSafe -query D-Nix | Get-PASSafeMember | Where-Object { $_.Permissions -contains 'Add' }
```

```diff 1[1:25] title="Piping Support for Advanced Users" subtitle="First: Get all safes matching our query"

```

```diff 1[28:45] title="Piping Support for Advanced Users" subtitle="Second: Get all Safe Members for all safes returned"

```

```diff 1[48:95] title="Piping Support for Advanced Users" subtitle="Finally: Return only Safe Members having any 'Add' permission"

```

```diff 1[63:65] title="Piping Support for Advanced Users" subtitle="This references our object being piped"

```

```powershell title="Piping Support for Advanced Users" subtitle="List Safes Username is NOT a Member Of"
Get-PASSafe | ForEach-Object { if ($(Get-PASSafeMember -SafeName $_.SafeName) -notcontains "CyberArk_Vault_Admins") { Write-Output $_.SafeName } }
```

```diff 1[1:12] title="Piping Support for Advanced Users" subtitle="First: Get all safes"

```

```diff 1[15:31] title="Piping Support for Advanced Users" subtitle="For each object returned..."

```

```diff 1[32:116] title="Piping Support for Advanced Users" subtitle="... if CyberArk_Vault_Admins is not a member of the safe..."

```

```diff 1[117:145] title="Piping Support for Advanced Users" subtitle="Write the safe name to output for our audit report"

```

</CodeSurfer>

---

<!-- {/* <CodeSurfer>

```js
function lorem(ipsum, dolor = 1) {
  const sit = ipsum == null ? 0 : ipsum.sit;
  dolor = sit - amet(dolor);
  return sit
    ? consectetur(ipsum, 0, dolor < 0 ? 0 : dolor)
    : [];
}

function adipiscing(...elit) {
  if (!elit.sit) {
    return [];
  }

  const sed = elit[0];
  return eiusmod.tempor(sed) ? sed : [sed];
}

function incididunt(ipsum, ut = 1) {
  ut = labore.et(amet(ut), 0);
  const sit = ipsum == null ? 0 : ipsum.sit;

  if (!sit || ut < 1) {
    return [];
  }

  let dolore = 0;
  let magna = 0;
  const aliqua = new eiusmod(labore.ut(sit / ut));

  while (dolore < sit) {
    aliqua[magna++] = consectetur(
      ipsum,
      dolore,
      (dolore += ut)
    );
  }

  return aliqua;
}
```

```diff 1[10:14],2[15:19],3[22:27],10:12

```

</CodeSurfer>

---

<CodeSurferColumns themes={[primary, secondary]}>

<Step>

```js
const magna = aliqua => aliqua.ut((enim, ad) => enim, 0);
```

```js
const minim = (ad, enim) => dolore.magna(ad / enim);
```

</Step>

<Step>

```js
const lorem = (ipsum, dolor, sit) => {
  const amet = dolor - ipsum;
  return consectetur.adipiscing(
    {
      elit: sed.eiusmod(sit - dolor) / amet + 2,
    },
    (tempor, incididunt) => ipsum + amet * incididunt
  );
};

const magna = aliqua => aliqua.ut((enim, ad) => enim, 0);
```

```js
const minim = (ad, enim) => dolore.magna(ad / enim);

const sed = (eiusmod, tempor, incididunt) => {
  const ut = tempor - eiusmod;
  return labore.et(
    {
      amet: dolore.magna(incididunt - tempor) / ut + 2,
    },
    (aliqua, elit) => eiusmod + ut * elit
  );
};
```

</Step>

</CodeSurferColumns>

---

docs:  
[codesurfer.pomb.us](https://codesurfer.pomb.us) */} -->
